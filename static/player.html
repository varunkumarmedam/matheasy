<html>

<head>
    <title>
        Place Holder
    </title>
    <script src="./js/mydata.js"></script>
    <script src="./js/jquery.js" onload="window.$ = window.jQuery = module.exports;"></script>
    <link rel="stylesheet" type="text/css" href="./css/style.css" />
    <link rel="stylesheet" type="text/css" href="./css/bootstrap.min.css" />
    <script src="./js/bootstrap.min.js"></script>
    <script>

        //Callback for Next Slide for all Lessons
        function next() {
            scrollId++;
            $("#status").html(scrollId);
            console.log("in next function Page - " + scrollId + " in chapter " + (chapter) + " in Lesson " + (lesson));
            $("#main_image").attr('src', './images/' + subject + '/' + (lesson) + '/' + (chapter) + '/' + scrollId + '.jpg');
            checkDisability(scrollId);
        };

        //Callback for Previous Slide for all Lessons
        function prev() {
            if (scrollId > 1) {
                scrollId--;
                $("#status").html(scrollId);
                console.log("Page - " + scrollId + " in chapter " + (chapter) + " in Lesson " + (lesson));
                $("#main_image").attr('src', './images/' + subject + '/' + (lesson) + '/' + (chapter) + '/' + scrollId + '.jpg');
                checkDisability(scrollId);
            }

        };

        //Making Buttons to be Disabled 
        function checkDisability(btnId) {
            (btnId <= 1) ? $("#prev").attr("disabled", "true") : $("#prev").removeAttr("disabled", "false");
            (btnId >= chapterLen) ? $("#next").attr("disabled", "true") : $("#next").removeAttr("disabled",
                "false");
        }
    </script>
</head>

<body>

    <div class="row" style="height: 95%;">
        <div class="col-3">
            <!--Side Loader-->
            <h3 id="title"></h3>
            <div id="accordionEx" role="tablist" aria-multiselectable="true"
                style="margin-left: 20px; margin-top: 20px;">
                <div id="generated">
                </div>
            </div>
        </div>

        <!-- Main Frame Starts here -->
        <div class="col-9">
            <img id="main_image" width="98%" height="94%" alt="Slide not available">

            <div class="row justify-content-around" style="margin-top: 20px;" id="options">
                <button class="learn-more" id="prev" onclick="prev()">

                    <span class="circle" aria-hidden="false">
                        <span class="icon arrow"></span>
                    </span>
                    <span class="button-text">Previous</span>
                </button>

                <span>
                    <h3 id="status">1</h3>
                </span>
                /
                <span>
                    <h3 id="chapterLength"></h3>
                </span>

                <button class="learn-more" id="next" onclick="next()">
                    <span class="circle" aria-hidden="true">
                        <span class="icon arrow"></span>
                    </span>
                    <span class="button-text">Next</span>
                </button>
            </div>
        </div>
    </div>

</body>

<script>
    var scrollId = 0;
    var lesson = 1;
    var chapter = 1;
    var subject;
    var chapterLen = 1;
    var pd;

    function updateDetails(d1, d2) {
        $("#options").slideDown(5);
        console.log(`main chapter ${d2}, ${d1}`);
        scrollId = 0;
        lesson = d1 + 1;
        chapter = d2 + 1;
        chapterLen = pd["lessons"][d1]["chapters"][d2]["length"];
        $("#chapterLength").html(chapterLen);
        console.log(`Chapter : ${chapter}, Lesson : ${lesson}, Number of chapters ${chapterLen}`);
        next();
    }

    $(function () {
        $("#options").slideUp(5);
        //getting Subject from URL
        const params = new URLSearchParams(document.location.search);
        console.log(params.get("sub"));
        subject = params.get("sub");
        pd = data[params.get("sub")];
        $("#title").html(pd["title"]);
        var dummy;
        var tempHead;
        var tempCollapse;
        var cardBody = "";

        //Displaying Sidebar Data
        for (var dummy = 0; dummy < pd["lessons"].length; dummy++) {
            tempHead = "heading" + (dummy + 1).toString();
            tempCollapse = "collapse" + (dummy + 1).toString();

            //Loop to generate chapters code
            for (var dum = 0; dum < pd["lessons"][dummy]["chapters"].length; dum++) {
                console.log(pd["lessons"][dummy]["chapters"][dum]["title"]);
                cardBody = cardBody + '<button onclick="updateDetails(' + dummy + ', ' + dum + ')"><div class="card-body">' + pd["lessons"][dummy]["chapters"][dum]["title"] + '</div></button><br>';
            }

            //Entire side body code
            $("#generated").append('<div class="card-header" role="tab" id=' + tempHead + '> <a data-toggle="collapse" data-parent="#accordionEx" href= "#' + tempCollapse + '" aria-controls=' + tempCollapse + ' style="text-decoration:none"> <h5 class="mb-0">' + pd["lessons"][dummy]["title"] + '<i class="fas fa-angle-down rotate-icon"></i> </h5></a></div><div id=' + tempCollapse + ' class="collapse" role="tabpanel" aria-labelledby=' + tempHead + ' data-parent="#accordionEx">' + cardBody + '');
            cardBody = "";
        }

        //Called when the App Loads at first time
        checkDisability(scrollId);

        //Loading Image for First Time
        $("#main_image").attr('src', './images/' + params.get("sub").toString() + '/intro.jpg');

    })
</script>

</html>